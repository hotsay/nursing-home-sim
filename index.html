<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìš”ì–‘ì› ê²½ì˜ í†µí•© ì‹œë®¬ë ˆì´í„° v4.9</title>
    <style>
        :root {
            --primary: #2c3e50; --accent: #3498db; --success: #27ae60; --danger: #e74c3c; --bg: #f1f4f9;
        }
        body { font-family: 'Pretendard', sans-serif; background: var(--bg); margin: 0; padding: 0; color: #333; }
        
        .tab-nav { background: var(--primary); display: flex; justify-content: center; align-items: center; padding: 10px 0; position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        .tab-btn { background: none; border: none; color: rgba(255,255,255,0.6); padding: 12px 25px; font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: 0.3s; border-radius: 8px; margin: 0 10px; }
        .tab-btn.active { color: white; background: rgba(255,255,255,0.15); box-shadow: inset 0 -3px 0 var(--accent); }
        
        .action-btns { position: fixed; bottom: 25px; right: 25px; display: flex; gap: 10px; z-index: 2000; }
        .btn-print { background: var(--accent); color: white; border: none; padding: 12px 20px; border-radius: 50px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.2); display: flex; align-items: center; gap: 8px; }
        .btn-excel { background: var(--success); color: white; border: none; padding: 12px 20px; border-radius: 50px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.2); display: flex; align-items: center; gap: 8px; }

        .container { max-width: 98%; margin: 20px auto; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        .dashboard { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 25px; }
        .card { background: var(--primary); color: white; padding: 15px; border-radius: 12px; text-align: center; }
        .card h3 { margin: 0; font-size: 0.9rem; opacity: 0.8; }
        .card .value { font-size: 1.5rem; font-weight: bold; margin: 5px 0; color: #fff; }

        .main-grid { display: grid; grid-template-columns: 1fr 1.6fr; gap: 25px; }
        section { background: #fff; border: 1px solid #e0e6ed; padding: 20px; border-radius: 12px; margin-bottom: 20px; }
        h2 { font-size: 1.2rem; color: var(--primary); border-left: 5px solid var(--accent); padding-left: 10px; margin-bottom: 15px; }

        table { width: 100%; border-collapse: collapse; margin-bottom: 15px; }
        th, td { border: 1px solid #eee; padding: 8px 4px; text-align: center; font-size: 0.85rem; }
        th { background: #f8f9fa; color: #666; }
        input { width: 90%; padding: 6px; border: 1px solid #ccc; border-radius: 4px; text-align: right; font-weight: bold; }
        
        .sub-total { background: #f8f9fa; font-weight: bold; }
        .status-badge { display: inline-block; padding: 5px 15px; border-radius: 20px; font-weight: bold; margin-top: 5px; }
        .pass { background: #2ecc71; color: white; }
        .fail { background: #e74c3c; color: white; }
        .analysis-box { background: #f9f9f9; padding: 15px; border-radius: 8px; border: 1px dashed #ccc; }
        .analysis-res { font-size: 1.1rem; font-weight: bold; margin-top: 10px; text-align: center; padding: 10px; border-radius: 8px; }

        @media print {
            .tab-nav, .action-btns, .tab-btn { display: none !important; }
            body { background: white; padding: 0; }
            .container { box-shadow: none; margin: 0; width: 100%; max-width: 100%; }
            input { border: none !important; background: transparent !important; text-align: center; }
        }
    </style>
</head>
<body>

<nav class="tab-nav">
    <button class="tab-btn active" onclick="openTab('tab-ratio')">ğŸ“Š ì¸ê±´ë¹„ ì§€ì¶œ ë¹„ìœ¨ ë¶„ì„</button>
    <button class="tab-btn" onclick="openTab('tab-night')">ğŸŒ™ ì•¼ê°„ ê·¼ë¬´ ìˆ˜ì§€ ë¶„ì„</button>
</nav>

<div class="action-btns">
    <button class="btn-excel" onclick="exportDetailedExcel()">ğŸ“Š ì—‘ì…€ìƒì„¸ë‚´ì—­ ì €ì¥</button>
    <button class="btn-print" onclick="window.print()">ğŸ–¨ï¸ PDF/ì¸ì‡„</button>
</div>

<div class="container">
    <div id="tab-ratio" class="tab-content active">
        <h1 style="text-align:center; color:var(--primary); margin-top:0;">ìš”ì–‘ì› ì¸ê±´ë¹„ ì§€ì¶œ ë¹„ìœ¨ ì‹œë®¬ë ˆì´í„°</h1>
        <div class="dashboard">
            <div class="card"><h3>ì´ ì…ì†Œ ì¸ì›</h3><div id="top-inmates" class="value">0 ëª…</div></div>
            <div class="card"><h3>ì´ ê¸‰ì—¬ ìˆ˜ì… (A)</h3><div id="top-total-income" class="value">0</div></div>
            <div class="card"><h3>ì´ ì¸ê±´ë¹„ ì§€ì¶œ (B)</h3><div id="top-total-labor" class="value">0</div></div>
            <div id="ratio-card" class="card">
                <h3>ì¸ê±´ë¹„ ì§€ì¶œ ë¹„ìœ¨ (B/A)</h3>
                <div id="top-ratio" style="font-size: 1.8rem; font-weight: bold;">0%</div>
                <div id="status-badge" class="status-badge">ê³„ì‚° ì¤‘...</div>
            </div>
        </div>
        <div class="main-grid">
            <div id="ratio-excel-1">
                <section>
                    <h2>1. ìˆ˜ì… ì„¤ì • (30ì¼ ê¸°ì¤€)</h2>
                    <table id="table-income">
                        <thead><tr><th>ë“±ê¸‰</th><th>ì¸ì›</th><th>ìˆ˜ê°€</th><th>ì›” ìˆ˜ì…</th></tr></thead>
                        <tbody>
                            <tr><td>ì¼ë°˜ 1ë“±ê¸‰</td><td><input type="number" id="in-c1" value="5" oninput="calculate()"></td><td>93,070</td><td id="res-c1">0</td></tr>
                            <tr><td>ì¼ë°˜ 2ë“±ê¸‰</td><td><input type="number" id="in-c2" value="13" oninput="calculate()"></td><td>86,340</td><td id="res-c2">0</td></tr>
                            <tr><td>ì¼ë°˜ 3~5ë“±ê¸‰</td><td><input type="number" id="in-c3" value="34" oninput="calculate()"></td><td>81,540</td><td id="res-c3">0</td></tr>
                            <tr><td>ì¹˜ë§¤ì „ë‹´ 2ë“±ê¸‰</td><td><input type="number" id="in-cd2" value="0" oninput="calculate()"></td><td>96,950</td><td id="res-cd2">0</td></tr>
                            <tr><td>ì¹˜ë§¤ì „ë‹´ 3~5ë“±ê¸‰</td><td><input type="number" id="in-cd3" value="48" oninput="calculate()"></td><td>89,400</td><td id="res-cd3">0</td></tr>
                            <tr class="sub-total"><td>í•©ê³„</td><td id="total-cnt">0</td><td>-</td><td id="total-base-inc">0</td></tr>
                        </tbody>
                    </table>
                </section>
                <section>
                    <h2>2. ê°€ì‚° ìˆ˜ì… ìƒì„¸</h2>
                    <table style="background:#f1f9ff" id="table-bonus">
                        <tr><th>í•­ëª©</th><th>ì ìš© ì ìˆ˜</th><th>ê°€ì‚° ìˆ˜ì…ì•¡</th></tr>
                        <tr><th>ê°€ì‚° ê¸°ì¤€ì  (1ì ë‹¹)</th><td colspan="2" id="base-point-val" style="font-weight:bold; color:var(--accent); text-align:right; padding-right:15px;">0</td></tr>
                        <tr><td>ì•¼ê°„ ê°€ì‚° (ì¸ë‹¹ 0.9ì )</td><td id="score-night">0 ì </td><td id="res-night-inc">0</td></tr>
                        <tr><td>ì¸ë ¥ì¶”ê°€ ê°€ì‚° <small id="limit-info"></small></td><td id="score-staff">0 ì </td><td id="res-staff-inc">0</td></tr>
                        <tr><td>ì¹˜ë§¤ì „ë‹´ ìš”ì–‘ë³´í˜¸ì‚¬ ê°€ì‚°</td><td id="score-dem-care">0 ì </td><td id="res-dem-care-inc">0</td></tr>
                        <tr><td>ê°„í˜¸ì‚¬ ê°€ì‚°</td><td id="score-nurse">0 ì </td><td id="res-nurse-bonus-inc">0</td></tr>
                        <tr style="background:#fff"><td><b>ì¥ê¸°ê·¼ì† ì¥ë ¤ê¸ˆ</b></td><td>-</td><td><input type="number" id="long-term-val" value="0" oninput="calculate()"></td></tr>
                        <tr class="sub-total"><th>ì´ ê°€ì‚° í•©ê³„</th><td id="score-total">0 ì </td><td id="res-total-add-inc">0</td></tr>
                    </table>
                </section>
            </div>
            <div id="ratio-excel-2">
                <section>
                    <h2>3. ì¸ê±´ë¹„ ì„¤ì •</h2>
                    <table id="table-labor">
                        <thead><tr><th>ì§ì¢…</th><th>ë°°ì¹˜</th><th>ë²•ì •</th><th>ê¸°ë³¸ê¸‰</th><th>ê¸‰ì—¬ì†Œê³„</th><th>4ëŒ€ë³´í—˜</th><th>í‡´ì§</th><th>ì¸ê±´ë¹„ì´ê³„</th></tr></thead>
                        <tbody id="staff-table"></tbody>
                        <tfoot style="background:#fff9db">
                            <tr>
                                <td><b>ì•¼ê°„ì¸ë ¥</b></td>
                                <td><input type="number" id="night-cnt" value="1" oninput="calculate()"></td>
                                <td>-</td>
                                <td>1,083,600</td>
                                <td id="night-base-sum">0</td>
                                <td id="night-ins">0</td>
                                <td id="night-ret">0</td>
                                <td id="night-total">0</td>
                            </tr>
                            <tr style="background:#e8f5e9">
                                <td><b>ì¥ê¸°ê·¼ì†ìˆ˜ë‹¹</b></td>
                                <td colspan="3"><small>ì§€ì¶œ(A=Bë™ì¼)</small></td>
                                <td id="long-term-base">0</td>
                                <td>-</td>
                                <td>-</td>
                                <td id="long-term-total">0</td>
                            </tr>
                        </tfoot>
                    </table>
                </section>
            </div>
        </div>
    </div>

    <div id="tab-night" class="tab-content">
        <h1 style="text-align:center; color:var(--primary); margin-top:0;">ğŸŒ™ ì•¼ê°„ê·¼ë¬´ ë°°ì¹˜ ë° ìˆ˜ì§€ë¶„ì„ ì‹œë®¬ë ˆì´í„°</h1>
        <div class="dashboard">
            <div class="card"><h3>ì•¼ê°„ ê°€ì‚° ìˆ˜ì… (A)</h3><div id="n-disp-income" class="value">0</div><small>í•œë‹¬ ì´ì•¡</small></div>
            <div class="card"><h3>ì•¼ê°„ ì¸ê±´ë¹„ ì´ê³„ (B)</h3><div id="n-disp-labor" class="value">0</div><small>ë³´í—˜/í‡´ì§ê¸ˆ í¬í•¨</small></div>
            <div id="n-profit-card" class="card"><h3>ì•¼ê°„ ìš´ì˜ ìˆ˜ì§€ (A - B)</h3><div id="n-disp-profit" class="value">0</div><small>ìˆ˜ìµ/ì†ì‹¤ ë¶„ì„</small></div>
            <div class="card" style="background:#fff; color:var(--primary); border:1px solid var(--accent);">
                <h3>ê°€ì‚° ê¸°ì¤€ì  (1ì )</h3><div id="n-disp-base-point" class="value" style="color:var(--accent);">0</div><small>(ì›” ìˆ˜ê°€ í•©ê³„ / ì¸ì›) Ã— 0.8</small>
            </div>
        </div>
        <div class="main-grid" style="grid-template-columns: 1fr 1fr;">
            <div id="night-excel-1">
                <section>
                    <h2>1. ê°€ì‚° ê¸°ì¤€ì  ì‚°ì¶œ (ì¼ë°˜ì‹¤ êµ¬ì„±)</h2>
                    <table id="n-table-base">
                        <thead><tr><th>ë“±ê¸‰</th><th>ì¸ì›(ëª…)</th><th>ì¼ë‹¹ ìˆ˜ê°€</th><th>ì›” ìˆ˜ì…ì•¡</th></tr></thead>
                        <tbody>
                            <tr><td>1ë“±ê¸‰</td><td><input type="number" id="n-in-c1" value="5" oninput="calcNight()"></td><td>93,070</td><td id="n-res-c1">0</td></tr>
                            <tr><td>2ë“±ê¸‰</td><td><input type="number" id="n-in-c2" value="13" oninput="calcNight()"></td><td>86,340</td><td id="n-res-c2">0</td></tr>
                            <tr><td>3~5ë“±ê¸‰</td><td><input type="number" id="n-in-c3" value="34" oninput="calcNight()"></td><td>81,540</td><td id="n-res-c3">0</td></tr>
                            <tr class="sub-total"><td>í•©ê³„</td><td id="n-total-cnt">0</td><td>-</td><td id="n-total-inc">0</td></tr>
                        </tbody>
                    </table>
                    <div class="info-box">í˜„ì¬ ì‚°ì¶œëœ 1ì ë‹¹ ê¸ˆì•¡: <span id="n-base-point-val" class="highlight">0</span> ì›</div>
                </section>
            </div>
            <div id="night-excel-2">
                <section>
                    <h2>2. ì•¼ê°„ ê·¼ë¬´ì ì‹œê°„ ë°°ì¹˜</h2>
                    <table id="n-table-work">
                        <tr><th>ì•¼ê°„ ì‹¤ê·¼ë¬´(h)</th><td><input type="number" id="n-work-h" value="5" oninput="calcNight()"></td></tr>
                        <tr><th>ì•¼ê°„ ì¸ì›(ëª…)</th><td><input type="number" id="n-staff-c" value="3" oninput="calcNight()"></td></tr>
                        <tr class="sub-total"><th>ì¼ì¼ í•©ê³„ ì‹œê°„</th><td id="n-total-hours-day">0 h</td></tr>
                    </table>
                </section>
                <section>
                    <h2>3. ì¸ê±´ë¹„ ìƒì„¸ (ì›” ê¸°ì¤€)</h2>
                    <table id="n-table-labor">
                        <tr><td>ìˆœìˆ˜ ì•¼ê°„ìˆ˜ë‹¹</td><td id="n-pure-wage">0</td></tr>
                        <tr><td>4ëŒ€ë³´í—˜(9%)</td><td id="n-ins-wage">0</td></tr>
                        <tr><td>í‡´ì§ì ë¦½ê¸ˆ(1/12)</td><td id="n-ret-wage">0</td></tr>
                        <tr class="sub-total"><td>ì´ ì•¼ê°„ ì¸ê±´ë¹„</td><td id="n-total-labor-detail" class="text-danger">0</td></tr>
                    </table>
                </section>
                <section>
                    <h2>4. ìˆ˜ì§€ ë¶„ì„ ê²°ê³¼</h2>
                    <div id="n-analysis-msg" class="analysis-res" style="background:#f9f9f9; border:1px dashed #ccc;">ê³„ì‚° ì¤‘...</div>
                </section>
            </div>
        </div>
    </div>
</div>

<script>
    function openTab(tabName) {
        document.querySelectorAll(".tab-content").forEach(tab => tab.classList.remove("active"));
        document.querySelectorAll(".tab-btn").forEach(btn => btn.classList.remove("active"));
        document.getElementById(tabName).classList.add("active");
        event.currentTarget.classList.add("active");
        if(tabName === 'tab-ratio') calculate(); else calcNight();
    }

    const staffMeta = {
        sw: { name: 'ì‚¬íšŒë³µì§€ì‚¬', pay: 2500000 },
        pt: { name: 'ë¬¼ë¦¬ì¹˜ë£Œì‚¬', pay: 2600000 },
        ot: { name: 'ì‘ì—…ì¹˜ë£Œì‚¬', pay: 2400000 },
        nurse: { name: 'ê°„í˜¸ì‚¬', pay: 2600000 },
        nurse_sub: { name: 'ê°„í˜¸ì¡°ë¬´ì‚¬', pay: 2300000 },
        care: { name: 'ìš”ì–‘ë³´í˜¸ì‚¬(ì¼ë°˜)', pay: 2156880 },
        care_dem: { name: 'ìš”ì–‘ë³´í˜¸ì‚¬(ì¹˜ë§¤)', pay: 2156880 }
    };

    function init() {
        const body = document.getElementById('staff-table');
        body.innerHTML = '';
        Object.entries(staffMeta).forEach(([key, info]) => {
            const tr = document.createElement('tr');
            tr.innerHTML = `<td align="left"><b>${info.name}</b></td><td><input type="number" id="cnt-${key}" value="${key==='care'?25:1}" oninput="calculate()"></td><td id="leg-${key}">0</td><td><input type="number" id="pay-${key}" value="${info.pay}" oninput="calculate()"></td><td id="base-sum-${key}">0</td><td id="ins-${key}">0</td><td id="ret-${key}">0</td><td id="total-${key}" style="font-weight:bold">0</td>`;
            body.appendChild(tr);
        });
        calculate();
        calcNight();
    }

    function calculate() {
        const p_list = { c1:93070, c2:86340, c3:81540, cd2:96950, cd3:89400 };
        let inmates = 0, genInmates = 0, genInc = 0, baseInc = 0;
        ['c1', 'c2', 'c3', 'cd2', 'cd3'].forEach(k => {
            const cnt = Number(document.getElementById('in-'+k).value);
            const inc = cnt * p_list[k] * 30;
            document.getElementById('res-'+k).innerText = inc.toLocaleString();
            inmates += cnt; baseInc += inc;
            if(!k.startsWith('cd')) { genInmates += cnt; genInc += inc; }
        });
        document.getElementById('total-cnt').innerText = inmates + " ëª…";
        document.getElementById('top-inmates').innerText = inmates + " ëª…";
        let scoreLimit = (inmates < 10) ? 1.4 : (inmates < 30) ? 2.6 : (inmates < 50) ? 4.0 : (inmates < 70) ? 5.2 : (inmates < 90) ? 6.6 : 7.8;
        document.getElementById('limit-info').innerText = `(í•œë„: ${scoreLimit}ì )`;
        const legal = { sw: inmates > 100 ? 2 : 1, pt_ot: inmates >= 30 ? 1 : 0, nurse_total: inmates <= 30 ? 1 : Math.ceil(inmates / 25), care: Math.ceil(genInmates / 2.1), care_dem: Math.ceil((inmates-genInmates) / 2.0) };
        let totalLabor = 0, genAddScore = 0, demCareAddScore = 0, totalStaffCount = 0;
        const c_nurse = Number(document.getElementById('cnt-nurse').value);
        const c_nurse_sub = Number(document.getElementById('cnt-nurse_sub').value);
        const c_pt = Number(document.getElementById('cnt-pt').value);
        const c_ot = Number(document.getElementById('cnt-ot').value);
        Object.entries(staffMeta).forEach(([key, info]) => {
            const cnt = Number(document.getElementById('cnt-'+key).value);
            const pay = Number(document.getElementById('pay-'+key).value);
            totalStaffCount += cnt;
            let legNum = (key === 'sw') ? legal.sw : (key === 'care') ? legal.care : (key === 'care_dem') ? legal.care_dem : (key === 'nurse' || key === 'nurse_sub') ? legal.nurse_total : (key === 'pt' || key === 'ot') ? legal.pt_ot : 0;
            document.getElementById('leg-'+key).innerText = legNum;
            const baseSum = pay * cnt;
            const ins = Math.floor(baseSum * 0.09);
            const ret = Math.floor(baseSum / 12);
            document.getElementById(`base-sum-${key}`).innerText = baseSum.toLocaleString();
            document.getElementById(`ins-${key}`).innerText = ins.toLocaleString();
            document.getElementById(`ret-${key}`).innerText = ret.toLocaleString();
            document.getElementById(`total-${key}`).innerText = (baseSum + ins + ret).toLocaleString();
            totalLabor += (baseSum + ins + ret);
            if(key === 'sw' && cnt > legal.sw) genAddScore += (cnt - legal.sw) * 1.4;
            if(key === 'care_dem' && cnt > legal.care_dem) demCareAddScore += (cnt - legal.care_dem) * 1.3;
        });
        if((c_nurse + c_nurse_sub) > legal.nurse_total) genAddScore += (c_nurse + c_nurse_sub - legal.nurse_total) * 1.2;
        if((c_pt + c_ot) > legal.pt_ot) genAddScore += (c_pt + c_ot - legal.pt_ot) * 1.4;
        let nurseAddScore = (c_nurse > 0) ? (c_nurse * 0.6) + 0.2 : 0;
        const nCnt = Number(document.getElementById('night-cnt').value);
        const nTotal = Math.floor(1083600 * nCnt * (1 + 0.09 + 1/12));
        totalLabor += nTotal;
        document.getElementById('night-base-sum').innerText = (1083600 * nCnt).toLocaleString();
        document.getElementById('night-ins').innerText = Math.floor(1083600 * nCnt * 0.09).toLocaleString();
        document.getElementById('night-ret').innerText = Math.floor(1083600 * nCnt / 12).toLocaleString();
        document.getElementById('night-total').innerText = nTotal.toLocaleString();
        const longTermValue = Number(document.getElementById('long-term-val').value);
        document.getElementById('long-term-base').innerText = longTermValue.toLocaleString();
        document.getElementById('long-term-total').innerText = longTermValue.toLocaleString();
        totalLabor += longTermValue;
        const basePoint = genInmates > 0 ? Math.floor((genInc / genInmates) * 0.8) : 0;
        document.getElementById('base-point-val').innerText = basePoint.toLocaleString();
        const finalNightScore = nCnt * 0.9;
        const finalGenScore = Math.min(genAddScore, scoreLimit);
        const totalScore = finalNightScore + finalGenScore + demCareAddScore + nurseAddScore;
        document.getElementById('score-night').innerText = finalNightScore.toFixed(1) + " ì ";
        document.getElementById('score-staff').innerText = finalGenScore.toFixed(1) + " ì ";
        document.getElementById('score-dem-care').innerText = demCareAddScore.toFixed(1) + " ì ";
        document.getElementById('score-nurse').innerText = nurseAddScore.toFixed(1) + " ì ";
        document.getElementById('score-total').innerText = totalScore.toFixed(1) + " ì ";
        const resNightInc = Math.floor(basePoint * finalNightScore);
        const resStaffInc = Math.floor(basePoint * finalGenScore);
        const resDemCareInc = Math.floor(basePoint * demCareAddScore);
        const resNurseBonusInc = Math.floor(basePoint * nurseAddScore);
        document.getElementById('res-night-inc').innerText = resNightInc.toLocaleString();
        document.getElementById('res-staff-inc').innerText = resStaffInc.toLocaleString();
        document.getElementById('res-dem-care-inc').innerText = resDemCareInc.toLocaleString();
        document.getElementById('res-nurse-bonus-inc').innerText = resNurseBonusInc.toLocaleString();
        const totalAddInc = resNightInc + resStaffInc + resDemCareInc + resNurseBonusInc + longTermValue;
        document.getElementById('res-total-add-inc').innerText = totalAddInc.toLocaleString();
        const totalFinalInc = baseInc + totalAddInc;
        document.getElementById('top-total-income').innerText = totalFinalInc.toLocaleString();
        document.getElementById('top-total-labor').innerText = totalLabor.toLocaleString();
        const ratio = totalFinalInc > 0 ? (totalLabor / totalFinalInc * 100).toFixed(1) : 0;
        document.getElementById('top-ratio').innerText = ratio + "%";
        const targetLabor = Math.floor(totalFinalInc * 0.626);
        document.getElementById('target-labor-val').innerText = targetLabor.toLocaleString();
        const badge = document.getElementById('status-badge');
        const card = document.getElementById('ratio-card');
        if(ratio >= 62.6) { badge.innerText = "ì¤€ìˆ˜ (PASS)"; badge.className = "status-badge pass"; card.style.background = "var(--success)"; } else { badge.innerText = "ë¯¸ë‹¬ (FAIL)"; badge.className = "status-badge fail"; card.style.background = "var(--danger)"; }
    }

    function calcNight() {
        const c1 = Number(document.getElementById('n-in-c1').value);
        const c2 = Number(document.getElementById('n-in-c2').value);
        const c3 = Number(document.getElementById('n-in-c3').value);
        const totalCnt = c1 + c2 + c3;
        const totalMonthInc = (c1 * 93070 + c2 * 86340 + c3 * 81540) * 30;
        const basePoint = totalCnt > 0 ? Math.floor((totalMonthInc / totalCnt) * 0.8) : 0;
        document.getElementById('n-res-c1').innerText = (c1 * 93070 * 30).toLocaleString();
        document.getElementById('n-res-c2').innerText = (c2 * 86340 * 30).toLocaleString();
        document.getElementById('n-res-c3').innerText = (c3 * 81540 * 30).toLocaleString();
        document.getElementById('n-total-cnt').innerText = totalCnt;
        document.getElementById('n-total-inc').innerText = totalMonthInc.toLocaleString();
        document.getElementById('n-base-point-val').innerText = basePoint.toLocaleString();
        document.getElementById('n-disp-base-point').innerText = basePoint.toLocaleString();
        const workH = Number(document.getElementById('n-work-h').value);
        const staffC = Number(document.getElementById('n-staff-c').value);
        const dayHours = workH * staffC;
        const pureMonthWage = dayHours * 30 * 5160;
        const totalLabor = Math.floor(pureMonthWage * (1 + 0.09 + 1/12));
        document.getElementById('n-total-hours-day').innerText = dayHours + " h";
        document.getElementById('n-pure-wage').innerText = pureMonthWage.toLocaleString();
        document.getElementById('n-ins-wage').innerText = Math.floor(pureMonthWage * 0.09).toLocaleString();
        document.getElementById('n-ret-wage').innerText = Math.floor(pureMonthWage / 12).toLocaleString();
        document.getElementById('n-total-labor-detail').innerText = totalLabor.toLocaleString();
        document.getElementById('n-disp-labor').innerText = totalLabor.toLocaleString();
        const addStaffDay = Math.floor(dayHours / 7);
        const income = Math.floor(addStaffDay * 0.9 * basePoint);
        document.getElementById('n-disp-income').innerText = income.toLocaleString();
        const profit = income - totalLabor;
        document.getElementById('n-disp-profit').innerText = profit.toLocaleString();
        const card = document.getElementById('n-profit-card');
        const msg = document.getElementById('n-analysis-msg');
        if (profit >= 0) { card.className = "card pass"; msg.innerHTML = `<span style="color:var(--success)">âœ… ìˆ˜ì§€ ì–‘í˜¸: +${profit.toLocaleString()}ì›</span>`; } else { card.className = "card fail"; msg.innerHTML = `<span style="color:var(--danger)">âš ï¸ ì†ì‹¤ ë°œìƒ: ${profit.toLocaleString()}ì›</span>`; }
    }

    function exportDetailedExcel() {
        let header = "<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:x='urn:schemas-microsoft-com:office:excel' xmlns='http://www.w3.org/TR/REC-html40'><head><meta charset='UTF-8'></head><body>";
        let body = "<h2>ìš”ì–‘ì› ê²½ì˜ ìƒì„¸ ë¦¬í¬íŠ¸</h2>";
        const getTable = (id, title) => {
            let clone = document.getElementById(id).cloneNode(true);
            clone.querySelectorAll('input').forEach(i => { let v = document.createTextNode(i.value); i.parentNode.replaceChild(v, i); });
            return "<h3>" + title + "</h3>" + clone.outerHTML + "<br>";
        };
        body += getTable('table-income', '1. ë“±ê¸‰ë³„ ìˆ˜ì…');
        body += getTable('table-bonus', '2. ê°€ì‚° ìƒì„¸');
        body += getTable('table-labor', '3. ì¸ê±´ë¹„ ìƒì„¸');
        if(document.getElementById('tab-night').classList.contains('active')) {
            body += getTable('n-table-base', 'ì•¼ê°„ë¶„ì„-ê¸°ì¤€ì ');
            body += getTable('n-table-work', 'ì•¼ê°„ë¶„ì„-ê·¼ë¬´ë°°ì¹˜');
        }
        let footer = "</body></html>";
        const blob = new Blob(['\ufeff' + header + body + footer], { type: 'application/vnd.ms-excel' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = 'ìš”ì–‘ì›_ìƒì„¸ë¦¬í¬íŠ¸.xls'; a.click();
    }

    window.onload = init;
</script>
</body>
</html>