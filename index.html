<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìš”ì–‘ì› ê²½ì˜ í†µí•© ì‹œë®¬ë ˆì´í„°</title>
    <style>
        :root {
            --primary: #2c3e50; --accent: #3498db; --success: #27ae60; --danger: #e74c3c; --bg: #f1f4f9;
        }
        body { font-family: 'Pretendard', sans-serif; background: var(--bg); margin: 0; padding: 0; color: #333; }
        
        /* í†µí•© íƒ­ ë„¤ë¹„ê²Œì´ì…˜ */
        .tab-nav { background: var(--primary); display: flex; justify-content: center; padding: 10px 0; position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        .tab-btn { background: none; border: none; color: rgba(255,255,255,0.6); padding: 12px 25px; font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: 0.3s; border-radius: 8px; margin: 0 10px; }
        .tab-btn.active { color: white; background: rgba(255,255,255,0.15); box-shadow: inset 0 -3px 0 var(--accent); }
        .tab-btn:hover { color: white; }

        .container { max-width: 98%; margin: 20px auto; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* ê³µí†µ ìŠ¤íƒ€ì¼ ìœ ì§€ */
        .dashboard { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 25px; }
        .card { background: var(--primary); color: white; padding: 15px; border-radius: 12px; text-align: center; }
        .card h3 { margin: 0; font-size: 0.9rem; opacity: 0.8; }
        .card .value { font-size: 1.5rem; font-weight: bold; margin: 5px 0; color: #fff; }
        .main-grid { display: grid; grid-template-columns: 1fr 1.6fr; gap: 25px; }
        section { background: #fff; border: 1px solid #e0e6ed; padding: 20px; border-radius: 12px; margin-bottom: 20px; }
        h2 { font-size: 1.2rem; color: var(--primary); border-left: 5px solid var(--accent); padding-left: 10px; margin-bottom: 15px; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 15px; }
        th, td { border: 1px solid #eee; padding: 8px 4px; text-align: center; font-size: 0.85rem; }
        th { background: #f8f9fa; color: #666; }
        input { width: 90%; padding: 6px; border: 1px solid #ccc; border-radius: 4px; text-align: right; font-weight: bold; font-family: inherit; }
        .sub-total { background: #f8f9fa; font-weight: bold; }
        .status-badge { display: inline-block; padding: 5px 15px; border-radius: 20px; font-weight: bold; margin-top: 5px; }
        .pass { background: #2ecc71; color: white; }
        .fail { background: #e74c3c; color: white; }
        .analysis-box { background: #f9f9f9; padding: 15px; border-radius: 8px; border: 1px dashed #ccc; }
        input.error { border: 2px solid var(--danger); background: #fff5f5; }
        .highlight { color: var(--accent); font-weight: bold; }
        .text-danger { color: var(--danger); }
        .analysis-res { font-size: 1.2rem; font-weight: bold; margin-top: 15px; text-align: center; padding: 15px; border-radius: 8px; }
    </style>
</head>
<body>

<nav class="tab-nav">
    <button class="tab-btn active" onclick="openTab('tab-ratio')">ğŸ“Š ì¸ê±´ë¹„ ì§€ì¶œ ë¹„ìœ¨ ë¶„ì„</button>
    <button class="tab-btn" onclick="openTab('tab-night')">ğŸŒ™ ì•¼ê°„ ê·¼ë¬´ ìˆ˜ì§€ ë¶„ì„</button>
</nav>

<div class="container">
    
    <div id="tab-ratio" class="tab-content active">
        <h1 style="text-align:center; color:var(--primary); margin-top:0;">ìš”ì–‘ì› ì¸ê±´ë¹„ ì§€ì¶œ ë¹„ìœ¨ ì‹œë®¬ë ˆì´í„°</h1>
        <div class="dashboard">
            <div class="card"><h3>ì´ ì…ì†Œ ì¸ì›</h3><div id="top-inmates" class="value">0 ëª…</div></div>
            <div class="card"><h3>ì´ ê¸‰ì—¬ ìˆ˜ì… (A)</h3><div id="top-total-income" class="value">0</div></div>
            <div class="card"><h3>ì´ ì¸ê±´ë¹„ ì§€ì¶œ (B)</h3><div id="top-total-labor" class="value">0</div></div>
            <div id="ratio-card" class="card">
                <h3>ì¸ê±´ë¹„ ì§€ì¶œ ë¹„ìœ¨ (B/A)</h3>
                <div id="top-ratio" style="font-size: 1.8rem; font-weight: bold;">0%</div>
                <div id="status-badge" class="status-badge">ê³„ì‚° ì¤‘...</div>
            </div>
        </div>
        <div class="main-grid">
            <div>
                <section>
                    <h2>1. ìˆ˜ì… ì„¤ì • (30ì¼ ê¸°ì¤€)</h2>
                    <table>
                        <thead><tr><th>ë“±ê¸‰</th><th>ì¸ì›</th><th>ìˆ˜ê°€</th><th>ì›” ìˆ˜ì…</th></tr></thead>
                        <tbody>
                            <tr><td>ì¼ë°˜ 1ë“±ê¸‰</td><td><input type="number" id="in-c1" value="5" oninput="calculate()"></td><td>93,070</td><td id="res-c1">0</td></tr>
                            <tr><td>ì¼ë°˜ 2ë“±ê¸‰</td><td><input type="number" id="in-c2" value="13" oninput="calculate()"></td><td>86,340</td><td id="res-c2">0</td></tr>
                            <tr><td>ì¼ë°˜ 3~5ë“±ê¸‰</td><td><input type="number" id="in-c3" value="34" oninput="calculate()"></td><td>81,540</td><td id="res-c3">0</td></tr>
                            <tr><td>ì¹˜ë§¤ì „ë‹´ 2ë“±ê¸‰</td><td><input type="number" id="in-cd2" value="0" oninput="calculate()"></td><td>96,950</td><td id="res-cd2">0</td></tr>
                            <tr><td>ì¹˜ë§¤ì „ë‹´ 3~5ë“±ê¸‰</td><td><input type="number" id="in-cd3" value="48" oninput="calculate()"></td><td>89,400</td><td id="res-cd3">0</td></tr>
                            <tr class="sub-total"><td>í•©ê³„</td><td id="total-cnt">0</td><td>-</td><td id="total-base-inc">0</td></tr>
                        </tbody>
                    </table>
                </section>
                <section style="margin-top:20px;">
                    <h2>2. ê°€ì‚° ìˆ˜ì… ìƒì„¸ (ì ìˆ˜ í¬í•¨)</h2>
                    <table style="background:#f1f9ff">
                        <tr><th>í•­ëª©</th><th>ì ìš© ì ìˆ˜</th><th>ê°€ì‚° ìˆ˜ì…ì•¡</th></tr>
                        <tr><th>ê°€ì‚° ê¸°ì¤€ì  (1ì ë‹¹)</th><td colspan="2" id="base-point-val" style="font-weight:bold; color:var(--accent); text-align:right; padding-right:15px;">0</td></tr>
                        <tr><td>ì•¼ê°„ ê°€ì‚° (ì¸ë‹¹ 0.9ì )</td><td id="score-night">0 ì </td><td id="res-night-inc">0</td></tr>
                        <tr><td>ì¸ë ¥ì¶”ê°€ ê°€ì‚° (ì¼ë°˜ì‹¤ í•œë„ë‚´)</td><td id="score-staff">0 ì </td><td id="res-staff-inc">0</td></tr>
                        <tr><td>ì¹˜ë§¤ì „ë‹´ ìš”ì–‘ë³´í˜¸ì‚¬ ê°€ì‚°</td><td id="score-dem-care">0 ì </td><td id="res-dem-care-inc">0</td></tr>
                        <tr><td>ê°„í˜¸ì‚¬ ê°€ì‚° (ì¸ë‹¹0.6+ì‹œì„¤0.2)</td><td id="score-nurse">0 ì </td><td id="res-nurse-bonus-inc">0</td></tr>
                        <tr class="sub-total"><th>ì´ ì ìˆ˜ ë° ê°€ì‚° í•©ê³„</th><td id="score-total" style="color:#e67e22;">0 ì </td><td id="res-total-add-inc">0</td></tr>
                    </table>
                </section>
            </div>
            <div>
                <section>
                    <h2>3. ì¸ê±´ë¹„ ì„¤ì • (ì•¼ê°„ìˆ˜ë‹¹ í¬í•¨)</h2>
                    <table>
                        <thead>
                            <tr><th>ì§ì¢…</th><th>ë°°ì¹˜</th><th>ë²•ì •</th><th>ê¸°ë³¸ê¸‰</th><th>ê¸‰ì—¬ì†Œê³„</th><th>4ëŒ€ë³´í—˜(9%)</th><th>í‡´ì§(1/12)</th><th>ì¸ê±´ë¹„ì´ê³„</th></tr>
                        </thead>
                        <tbody id="staff-table"></tbody>
                        <tfoot style="background:#fff9db">
                            <tr>
                                <td><b>ì•¼ê°„ì¸ë ¥</b></td>
                                <td><input type="number" id="night-cnt" value="1" oninput="calculate()"></td>
                                <td>-</td>
                                <td><input type="number" id="night-wage-info" value="1083600" readonly style="background:#eee"></td>
                                <td id="night-base-sum">0</td>
                                <td id="night-ins">0</td>
                                <td id="night-ret">0</td>
                                <td id="night-total" style="font-weight:bold; color:var(--danger)">0</td>
                            </tr>
                        </tfoot>
                    </table>
                </section>
                <section style="margin-top:20px;">
                    <h2>4. ì¸ê±´ë¹„ ì§€ì¶œ ë¹„ìœ¨ ë¶„ì„</h2>
                    <div class="analysis-box">
                        <p><b>ê¶Œì¥ ì¸ê±´ë¹„ ì´ì•¡ (62.6%):</b> <span id="target-labor-val" style="color:var(--success); font-weight:bold;">0</span> ì›</p>
                        <p><b>í˜„ì¬ 1ì¸ë‹¹ í‰ê·  ì¸ê±´ë¹„:</b> <span id="avg-labor-val" style="font-weight:bold;">0</span> ì›</p>
                        <hr>
                        <p id="analysis-text" style="margin:0; font-size:0.9rem;"></p>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <div id="tab-night" class="tab-content">
        <h1 style="text-align:center; color:var(--primary); margin-top:0;">ğŸŒ™ ì•¼ê°„ê·¼ë¬´ ë°°ì¹˜ ë° ìˆ˜ì§€ë¶„ì„ ì‹œë®¬ë ˆì´í„°</h1>
        <div class="dashboard">
            <div class="card"><h3>ì•¼ê°„ ê°€ì‚° ìˆ˜ì… (A)</h3><div id="n-disp-income" class="value">0</div><small>í•œë‹¬ ì´ì•¡</small></div>
            <div class="card"><h3>ì•¼ê°„ ì¸ê±´ë¹„ ì´ê³„ (B)</h3><div id="n-disp-labor" class="value">0</div><small>ë³´í—˜/í‡´ì§ê¸ˆ í¬í•¨</small></div>
            <div id="n-profit-card" class="card"><h3>ì•¼ê°„ ìš´ì˜ ìˆ˜ì§€ (A - B)</h3><div id="n-disp-profit" class="value">0</div><small>ìˆ˜ìµ/ì†ì‹¤ ë¶„ì„</small></div>
            <div class="card highlight"><h3>ê°€ì‚° ê¸°ì¤€ì  (1ì )</h3><div id="n-disp-base-point" class="value">0</div><small>(ì›” ìˆ˜ê°€ í•©ê³„ / ì¸ì›) Ã— 0.8</small></div>
        </div>
        <div class="main-grid" style="grid-template-columns: 1fr 1fr;">
            <section>
                <h2>1. ê°€ì‚° ê¸°ì¤€ì  ì‚°ì¶œ (ì¼ë°˜ì‹¤ ë“±ê¸‰ êµ¬ì„±)</h2>
                <table>
                    <thead><tr><th>ë“±ê¸‰</th><th>ì¸ì›(ëª…)</th><th>ì¼ë‹¹ ìˆ˜ê°€(ì›)</th><th>ì›” ìˆ˜ì…ì•¡(30ì¼)</th></tr></thead>
                    <tbody>
                        <tr><td>1ë“±ê¸‰</td><td><input type="number" id="n-in-c1" value="5" oninput="calcNight()"></td><td>93,070</td><td id="n-res-c1">0</td></tr>
                        <tr><td>2ë“±ê¸‰</td><td><input type="number" id="n-in-c2" value="13" oninput="calcNight()"></td><td>86,340</td><td id="n-res-c2">0</td></tr>
                        <tr><td>3~5ë“±ê¸‰</td><td><input type="number" id="n-in-c3" value="34" oninput="calcNight()"></td><td>81,540</td><td id="n-res-c3">0</td></tr>
                        <tr class="sub-total"><td><b>í•©ê³„</b></td><td id="n-total-cnt">0</td><td>-</td><td id="n-total-inc">0</td></tr>
                    </tbody>
                </table>
                <div class="info-box">ê¸°ì¤€ê¸ˆì•¡ = (ì¼ë°˜ì‹¤ ì›” ì´ìˆ˜ê°€ / ì…ì†Œì ìˆ˜) Ã— 0.8<br>í˜„ì¬ ì‚°ì¶œëœ 1ì ë‹¹ ê¸ˆì•¡: <span id="n-base-point-val" class="highlight">0</span> ì›</div>
            </section>
            <section>
                <h2>2. ì•¼ê°„ ê·¼ë¬´ì ì‹œê°„ ë°°ì¹˜</h2>
                <p style="font-size:0.85rem; color:#666; margin-bottom:10px;">* 22ì‹œ ~ 06ì‹œ ì‚¬ì´ ì‹¤ì œ ê·¼ë¡œì‹œê°„(íœ´ê²Œ ì œì™¸)ì„ ì…ë ¥í•˜ì„¸ìš”.</p>
                <table>
                    <thead><tr><th>êµ¬ë¶„</th><th>ì‹¤ê·¼ë¬´(h)</th><th>ì¸ì›(ëª…)</th><th>í•©ê³„ ì‹œê°„(ì¼)</th></tr></thead>
                    <tbody>
                        <tr><td><b>ì•¼ê°„ ì¸ë ¥</b></td><td><input type="number" id="n-work-h" value="5" oninput="calcNight()"></td><td><input type="number" id="n-staff-c" value="3" oninput="calcNight()"></td><td id="n-total-hours-day" style="font-weight:bold; color:var(--accent);">0 h</td></tr>
                    </tbody>
                </table>
                <div class="info-box" style="background:#fff9db; border-color:#ffeeba;"><b>[ì§€ì¶œ ë¶„ì„ - ìˆœìˆ˜ ì•¼ê°„ìˆ˜ë‹¹]</b><br>ì¼ì¼ ì•¼ê°„ìˆ˜ë‹¹: <span id="n-labor-day-pure">0</span> ì›<br>ì›” ì•¼ê°„ìˆ˜ë‹¹: <span id="n-labor-month-pure">0</span> ì›</div>
            </section>
            <section>
                <h2>3. ì¸ê±´ë¹„ ìƒì„¸ (4ëŒ€ë³´í—˜/í‡´ì§ê¸ˆ í¬í•¨)</h2>
                <table>
                    <thead><tr><th>í•­ëª©</th><th>ê¸ˆì•¡ (ì›” ê¸°ì¤€)</th></tr></thead>
                    <tbody>
                        <tr><td>ìˆœìˆ˜ ì•¼ê°„ìˆ˜ë‹¹ (ê¸°ë³¸)</td><td id="n-pure-wage">0</td></tr>
                        <tr><td>4ëŒ€ë³´í—˜ íšŒì‚¬ë¶€ë‹´ë¶„ (9%)</td><td id="n-ins-wage">0</td></tr>
                        <tr><td>í‡´ì§ì ë¦½ê¸ˆ (1/12)</td><td id="n-ret-wage">0</td></tr>
                        <tr class="sub-total"><td><b>ì´ ì•¼ê°„ ì¸ê±´ë¹„ í•©ê³„</b></td><td id="n-total-labor-detail" class="text-danger">0</td></tr>
                    </tbody>
                </table>
                <div class="info-box">ì•¼ê°„ìˆ˜ë‹¹ ë‹¨ê°€: 1ì‹œê°„ë‹¹ <b>5,160ì›</b> (10,320ì› Ã— 0.5)</div>
            </section>
            <section>
                <h2>4. ìˆ˜ì§€ ë¶„ì„ ë° íš¨ìœ¨ ì•ˆë‚´</h2>
                <table>
                    <tr><th>ì¼ì¼ ì´ ì•¼ê°„ì‹œê°„</th><td id="n-total-hours-day-val">0 h</td></tr>
                    <tr><th>ì¼ì¼ ê°€ì‚° ì¸ì • ì¸ì›</th><td id="n-add-staff-val">0 ëª…</td></tr>
                    <tr><th>ì¼ì¼ ì ˆì‚¬(ë²„ë ¤ì§€ëŠ”) ì‹œê°„</th><td id="n-waste-hours" class="text-danger">0 h</td></tr>
                    <tr class="sub-total"><td><b>ìµœì¢… ì•¼ê°„ ê°€ì‚°ê¸ˆ (ì›”)</b></td><td id="n-final-income-val" class="highlight">0</td></tr>
                </table>
                <div id="n-analysis-msg" class="analysis-res">ê³„ì‚° ì¤‘...</div>
            </section>
        </div>
    </div>
</div>

<script>
    // íƒ­ ì „í™˜ ë¡œì§
    function openTab(tabName) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tab-content");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].classList.remove("active");
        }
        tablinks = document.getElementsByClassName("tab-btn");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].classList.remove("active");
        }
        document.getElementById(tabName).classList.add("active");
        event.currentTarget.classList.add("active");
        
        // íƒ­ ì „í™˜ ì‹œ ê³„ì‚° ë‹¤ì‹œ ì‹¤í–‰
        if(tabName === 'tab-ratio') calculate();
        else calcNight();
    }

    // --- íŒŒì¼ 1: ì¸ê±´ë¹„ ë¹„ìœ¨ ì‹œë®¬ë ˆì´í„° ë¡œì§ ---
    const staffMeta = {
        sw: { name: 'ì‚¬íšŒë³µì§€ì‚¬', pay: 2500000 },
        pt: { name: 'ë¬¼ë¦¬ì¹˜ë£Œì‚¬', pay: 2600000 },
        ot: { name: 'ì‘ì—…ì¹˜ë£Œì‚¬', pay: 2400000 },
        nurse: { name: 'ê°„í˜¸ì‚¬', pay: 2600000 },
        nurse_sub: { name: 'ê°„í˜¸ì¡°ë¬´ì‚¬', pay: 2300000 },
        care: { name: 'ìš”ì–‘ë³´í˜¸ì‚¬(ì¼ë°˜)', pay: 2156880 },
        care_dem: { name: 'ìš”ì–‘ë³´í˜¸ì‚¬(ì¹˜ë§¤)', pay: 2156880 }
    };

    function init() {
        const body = document.getElementById('staff-table');
        body.innerHTML = '';
        Object.entries(staffMeta).forEach(([key, info]) => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td align="left"><b>${info.name}</b></td>
                <td><input type="number" id="cnt-${key}" value="${key==='care'?25:1}" oninput="calculate()"></td>
                <td id="leg-${key}">0</td>
                <td><input type="number" id="pay-${key}" value="${info.pay}" oninput="calculate()"></td>
                <td id="base-sum-${key}">0</td>
                <td id="ins-${key}">0</td>
                <td id="ret-${key}">0</td>
                <td id="total-${key}" style="font-weight:bold">0</td>
            `;
            body.appendChild(tr);
        });
        calculate();
        calcNight();
    }

    function calculate() {
        const p_list = { c1:93070, c2:86340, c3:81540, cd2:96950, cd3:89400 };
        let inmates = 0, genInmates = 0, demInmates = 0, genInc = 0, baseInc = 0;

        ['c1', 'c2', 'c3', 'cd2', 'cd3'].forEach(k => {
            const cnt = Number(document.getElementById('in-'+k).value);
            const inc = cnt * p_list[k] * 30;
            document.getElementById('res-'+k).innerText = inc.toLocaleString();
            inmates += cnt;
            baseInc += inc;
            if(!k.startsWith('cd')) { genInmates += cnt; genInc += inc; }
            else { demInmates += cnt; }
        });

        document.getElementById('total-cnt').innerText = inmates + " ëª…";
        document.getElementById('top-inmates').innerText = inmates + " ëª…";
        document.getElementById('total-base-inc').innerText = baseInc.toLocaleString();

        let scoreLimit = inmates < 30 ? 2.6 : inmates < 50 ? 4.0 : inmates < 90 ? 6.6 : 7.8;
        const legal = {
            sw: inmates > 100 ? 2 : 1,
            pt_ot: inmates >= 30 ? 1 : 0,
            nurse_total: inmates <= 30 ? 1 : Math.ceil(inmates / 25),
            care: Math.ceil(genInmates / 2.1),
            care_dem: Math.ceil(demInmates / 2.0)
        };

        let totalLabor = 0;
        let genAddScore = 0;
        let demCareAddScore = 0;
        let totalStaffCount = 0;

        const c_nurse = Number(document.getElementById('cnt-nurse').value);
        const c_nurse_sub = Number(document.getElementById('cnt-nurse_sub').value);
        const c_pt = Number(document.getElementById('cnt-pt').value);
        const c_ot = Number(document.getElementById('cnt-ot').value);

        Object.entries(staffMeta).forEach(([key, info]) => {
            const cnt = Number(document.getElementById('cnt-'+key).value);
            const pay = Number(document.getElementById('pay-'+key).value);
            const input = document.getElementById('cnt-'+key);
            totalStaffCount += cnt;

            let legNum = (key === 'sw') ? legal.sw : (key === 'care') ? legal.care : (key === 'care_dem') ? legal.care_dem : 0;
            if(key === 'nurse' || key === 'nurse_sub') legNum = legal.nurse_total;
            if(key === 'pt' || key === 'ot') legNum = legal.pt_ot;
            
            document.getElementById('leg-'+key).innerText = legNum;
            if((key === 'nurse' || key === 'nurse_sub' ? c_nurse+c_nurse_sub : key === 'pt' || key === 'ot' ? c_pt+c_ot : cnt) < legNum) input.classList.add('error'); else input.classList.remove('error');

            const baseSum = pay * cnt;
            const ins = Math.floor(baseSum * 0.09);
            const ret = Math.floor(baseSum / 12);
            document.getElementById(`base-sum-${key}`).innerText = baseSum.toLocaleString();
            document.getElementById(`ins-${key}`).innerText = ins.toLocaleString();
            document.getElementById(`ret-${key}`).innerText = ret.toLocaleString();
            document.getElementById(`total-${key}`).innerText = (baseSum + ins + ret).toLocaleString();
            totalLabor += (baseSum + ins + ret);

            if(key === 'sw' && cnt > legal.sw) genAddScore += (cnt - legal.sw) * 1.4;
            if(key === 'care_dem' && cnt > legal.care_dem) demCareAddScore += (cnt - legal.care_dem) * 1.3;
        });

        if((c_nurse + c_nurse_sub) > legal.nurse_total) genAddScore += (c_nurse + c_nurse_sub - legal.nurse_total) * 1.2;
        if((c_pt + c_ot) > legal.pt_ot) genAddScore += (c_pt + c_ot - legal.pt_ot) * 1.4;

        const nCnt = Number(document.getElementById('night-cnt').value);
        const nBaseSum = 1083600 * nCnt;
        const nIns = Math.floor(nBaseSum * 0.09);
        const nRet = Math.floor(nBaseSum / 12);
        const nTotal = nBaseSum + nIns + nRet;
        document.getElementById('night-base-sum').innerText = nBaseSum.toLocaleString();
        document.getElementById('night-ins').innerText = nIns.toLocaleString();
        document.getElementById('night-ret').innerText = nRet.toLocaleString();
        document.getElementById('night-total').innerText = nTotal.toLocaleString();
        totalLabor += nTotal;
        totalStaffCount += nCnt;

        const basePoint = genInmates > 0 ? Math.floor((genInc / genInmates) * 0.8) : 0;
        document.getElementById('base-point-val').innerText = basePoint.toLocaleString();

        const finalNightScore = nCnt * 0.9;
        const finalGenScore = Math.min(genAddScore, scoreLimit);
        const finalDemScore = demCareAddScore;
        const finalNurseScore = c_nurse > 0 ? (c_nurse * 0.6) + 0.2 : 0;
        const totalScore = finalNightScore + finalGenScore + finalDemScore + finalNurseScore;

        document.getElementById('score-night').innerText = finalNightScore.toFixed(1) + " ì ";
        document.getElementById('score-staff').innerText = finalGenScore.toFixed(1) + " ì ";
        document.getElementById('score-dem-care').innerText = finalDemScore.toFixed(1) + " ì ";
        document.getElementById('score-nurse').innerText = finalNurseScore.toFixed(1) + " ì ";
        document.getElementById('score-total').innerText = totalScore.toFixed(1) + " ì ";

        const resNightInc = Math.floor(basePoint * finalNightScore);
        const resStaffInc = Math.floor(basePoint * finalGenScore);
        const resDemCareInc = Math.floor(basePoint * finalDemScore);
        const resNurseBonusInc = Math.floor(basePoint * finalNurseScore);

        document.getElementById('res-night-inc').innerText = resNightInc.toLocaleString();
        document.getElementById('res-staff-inc').innerText = resStaffInc.toLocaleString();
        document.getElementById('res-dem-care-inc').innerText = resDemCareInc.toLocaleString();
        document.getElementById('res-nurse-bonus-inc').innerText = resNurseBonusInc.toLocaleString();

        const totalAddInc = resNightInc + resStaffInc + resDemCareInc + resNurseBonusInc;
        document.getElementById('res-total-add-inc').innerText = totalAddInc.toLocaleString();
        
        const totalFinalInc = baseInc + totalAddInc;

        document.getElementById('top-total-income').innerText = totalFinalInc.toLocaleString();
        document.getElementById('top-total-labor').innerText = totalLabor.toLocaleString();
        const ratio = totalFinalInc > 0 ? (totalLabor / totalFinalInc * 100).toFixed(1) : 0;
        document.getElementById('top-ratio').innerText = ratio + "%";

        const targetLabor = Math.floor(totalFinalInc * 0.626);
        document.getElementById('target-labor-val').innerText = targetLabor.toLocaleString();
        document.getElementById('avg-labor-val').innerText = totalStaffCount > 0 ? Math.floor(totalLabor / totalStaffCount).toLocaleString() : 0;

        const badge = document.getElementById('status-badge');
        const card = document.getElementById('ratio-card');
        const analysis = document.getElementById('analysis-text');

        if(ratio >= 62.6) {
            badge.innerText = "ì¤€ìˆ˜ (PASS)"; badge.className = "status-badge pass";
            card.style.background = "var(--success)";
            analysis.innerHTML = `ì¸ê±´ë¹„ ì§€ì¶œ ë¹„ìœ¨ ê¸°ì¤€ì„ ì¶©ì¡±í•©ë‹ˆë‹¤. <br>ê¶Œì¥ ì§€ì¶œì•¡ ëŒ€ë¹„ <b>${(totalLabor - targetLabor).toLocaleString()}ì›</b> ì¶”ê°€ ì§€ì¶œ ì¤‘ì…ë‹ˆë‹¤.`;
        } else {
            badge.innerText = "ë¯¸ë‹¬ (FAIL)"; badge.className = "status-badge fail";
            card.style.background = "var(--danger)";
            analysis.innerHTML = `ì¸ê±´ë¹„ ì§€ì¶œ ë¹„ìœ¨ì´ ë‚®ìŠµë‹ˆë‹¤. <br>ê¶Œì¥ ê¸°ì¤€ ë‹¬ì„±ì„ ìœ„í•´ <b>${(targetLabor - totalLabor).toLocaleString()}ì›</b> ì´ìƒì˜ ì¶”ê°€ ì§€ì¶œì´ í•„ìš”í•©ë‹ˆë‹¤.`;
        }
    }

    // --- íŒŒì¼ 2: ì•¼ê°„ ìˆ˜ì§€ ë¶„ì„ê¸° ë¡œì§ ---
    function calcNight() {
        const c1 = Number(document.getElementById('n-in-c1').value);
        const c2 = Number(document.getElementById('n-in-c2').value);
        const c3 = Number(document.getElementById('n-in-c3').value);
        
        const r1_day = 93070;
        const r2_day = 86340;
        const r3_day = 81540;

        const totalCnt = c1 + c2 + c3;
        const totalMonthInc = (c1 * r1_day + c2 * r2_day + c3 * r3_day) * 30;
        const basePoint = totalCnt > 0 ? Math.floor((totalMonthInc / totalCnt) * 0.8) : 0;

        document.getElementById('n-res-c1').innerText = (c1 * r1_day * 30).toLocaleString();
        document.getElementById('n-res-c2').innerText = (c2 * r2_day * 30).toLocaleString();
        document.getElementById('n-res-c3').innerText = (c3 * r3_day * 30).toLocaleString();
        document.getElementById('n-total-cnt').innerText = totalCnt;
        document.getElementById('n-total-inc').innerText = totalMonthInc.toLocaleString();
        document.getElementById('n-base-point-val').innerText = basePoint.toLocaleString();
        document.getElementById('n-disp-base-point').innerText = basePoint.toLocaleString();

        const workH = Number(document.getElementById('n-work-h').value);
        const staffC = Number(document.getElementById('n-staff-c').value);
        const dayHours = workH * staffC;
        const monthHours = dayHours * 30;

        document.getElementById('n-total-hours-day').innerText = dayHours + " h";
        document.getElementById('n-total-hours-day-val').innerText = dayHours + " h";

        const unitWage = 10320 * 0.5;
        const pureDayWage = Math.floor(dayHours * unitWage);
        const pureMonthWage = pureDayWage * 30;

        document.getElementById('n-labor-day-pure').innerText = pureDayWage.toLocaleString();
        document.getElementById('n-labor-month-pure').innerText = pureMonthWage.toLocaleString();

        const insWage = Math.floor(pureMonthWage * 0.09);
        const retWage = Math.floor(pureMonthWage / 12);
        const totalLabor = pureMonthWage + insWage + retWage;

        document.getElementById('n-pure-wage').innerText = pureMonthWage.toLocaleString();
        document.getElementById('n-ins-wage').innerText = insWage.toLocaleString();
        document.getElementById('n-ret-wage').innerText = retWage.toLocaleString();
        document.getElementById('n-total-labor-detail').innerText = totalLabor.toLocaleString();
        document.getElementById('n-disp-labor').innerText = totalLabor.toLocaleString();

        const addStaffCntDay = Math.floor(dayHours / 7); 
        const wasteHoursDay = dayHours % 7;
        const totalIncome = Math.floor(addStaffCntDay * 0.9 * basePoint);

        document.getElementById('n-add-staff-val').innerText = addStaffCntDay + " ëª…";
        document.getElementById('n-waste-hours').innerText = wasteHoursDay + " h";
        document.getElementById('n-final-income-val').innerText = totalIncome.toLocaleString();
        document.getElementById('n-disp-income').innerText = totalIncome.toLocaleString();

        const profit = totalIncome - totalLabor;
        document.getElementById('n-disp-profit').innerText = profit.toLocaleString();
        const profitCard = document.getElementById('n-profit-card');
        const analysisMsg = document.getElementById('n-analysis-msg');
        
        if (profit >= 0) {
            profitCard.className = "card result-plus";
            analysisMsg.style.background = "#e8f5e9";
            analysisMsg.style.color = "var(--success)";
            analysisMsg.innerHTML = `âœ… <b>ìˆ˜ì§€ ì–‘í˜¸:</b> ê°€ì‚°ê¸ˆì´ ì¸ê±´ë¹„ë³´ë‹¤ <b>${profit.toLocaleString()}ì›</b> ë” ë§ìŠµë‹ˆë‹¤.`;
        } else {
            profitCard.className = "card result-minus";
            analysisMsg.style.background = "#ffebee";
            analysisMsg.style.color = "var(--danger)";
            analysisMsg.innerHTML = `âš ï¸ <b>ì†ì‹¤ ë°œìƒ:</b> ì¸ê±´ë¹„ê°€ ê°€ì‚°ê¸ˆë³´ë‹¤ <b>${Math.abs(profit).toLocaleString()}ì›</b> ë” ë§ìŠµë‹ˆë‹¤.`;
        }

        if (wasteHoursDay > 0) {
            const gap = 7 - wasteHoursDay;
            analysisMsg.innerHTML += `<br><small style="color:#666">ğŸ’¡ ì¼ì¼ <b>${gap}ì‹œê°„</b>ë§Œ ë” í™•ë³´í•˜ë©´ ê°€ì‚° ì¸ì›ì´ 1ëª… ëŠ˜ì–´ë‚©ë‹ˆë‹¤.</small>`;
        }
    }

    window.onload = init;
</script>
</body>
</html>