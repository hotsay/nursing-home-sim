<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìš”ì–‘ì› ê²½ì˜ í†µí•© ì‹œë®¬ë ˆì´í„°</title>
    <style>
        :root {
            --primary: #2c3e50; --accent: #3498db; --success: #27ae60; --danger: #e74c3c; --bg: #f1f4f9;
        }
        body { font-family: 'Pretendard', sans-serif; background: var(--bg); margin: 0; padding: 0; color: #333; }
        .tab-nav { background: var(--primary); display: flex; justify-content: center; padding: 10px 0; position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        .tab-btn { background: none; border: none; color: rgba(255,255,255,0.6); padding: 12px 25px; font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: 0.3s; border-radius: 8px; margin: 0 10px; }
        .tab-btn.active { color: white; background: rgba(255,255,255,0.15); box-shadow: inset 0 -3px 0 var(--accent); }
        .tab-btn:hover { color: white; }
        .container { max-width: 98%; margin: 20px auto; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .dashboard { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 25px; }
        .card { background: var(--primary); color: white; padding: 15px; border-radius: 12px; text-align: center; }
        .card h3 { margin: 0; font-size: 0.9rem; opacity: 0.8; }
        .card .value { font-size: 1.5rem; font-weight: bold; margin: 5px 0; color: #fff; }
        .main-grid { display: grid; grid-template-columns: 1fr 1.6fr; gap: 25px; }
        section { background: #fff; border: 1px solid #e0e6ed; padding: 20px; border-radius: 12px; margin-bottom: 20px; }
        h2 { font-size: 1.2rem; color: var(--primary); border-left: 5px solid var(--accent); padding-left: 10px; margin-bottom: 15px; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 15px; }
        th, td { border: 1px solid #eee; padding: 8px 4px; text-align: center; font-size: 0.85rem; }
        th { background: #f8f9fa; color: #666; }
        input { width: 90%; padding: 6px; border: 1px solid #ccc; border-radius: 4px; text-align: right; font-weight: bold; font-family: inherit; }
        .sub-total { background: #f8f9fa; font-weight: bold; }
        .status-badge { display: inline-block; padding: 5px 15px; border-radius: 20px; font-weight: bold; margin-top: 5px; }
        .pass { background: #2ecc71; color: white; }
        .fail { background: #e74c3c; color: white; }
        .analysis-box { background: #f9f9f9; padding: 15px; border-radius: 8px; border: 1px dashed #ccc; }
        input.error { border: 2px solid var(--danger); background: #fff5f5; }
        .highlight { color: var(--accent); font-weight: bold; }
        .text-danger { color: var(--danger); }
    </style>
</head>
<body>

<nav class="tab-nav">
    <button class="tab-btn active" onclick="openTab('tab-ratio')">ğŸ“Š ì¸ê±´ë¹„ ì§€ì¶œ ë¹„ìœ¨ ë¶„ì„</button>
    <button class="tab-btn" onclick="openTab('tab-night')">ğŸŒ™ ì•¼ê°„ ê·¼ë¬´ ìˆ˜ì§€ ë¶„ì„</button>
</nav>

<div class="container">
    <div id="tab-ratio" class="tab-content active">
        <h1 style="text-align:center; color:var(--primary); margin-top:0;">ìš”ì–‘ì› ì¸ê±´ë¹„ ì§€ì¶œ ë¹„ìœ¨ ì‹œë®¬ë ˆì´í„°</h1>
        <div class="dashboard">
            <div class="card"><h3>ì´ ì…ì†Œ ì¸ì›</h3><div id="top-inmates" class="value">0 ëª…</div></div>
            <div class="card"><h3>ì´ ê¸‰ì—¬ ìˆ˜ì… (A)</h3><div id="top-total-income" class="value">0</div></div>
            <div class="card"><h3>ì´ ì¸ê±´ë¹„ ì§€ì¶œ (B)</h3><div id="top-total-labor" class="value">0</div></div>
            <div id="ratio-card" class="card">
                <h3>ì¸ê±´ë¹„ ì§€ì¶œ ë¹„ìœ¨ (B/A)</h3>
                <div id="top-ratio" style="font-size: 1.8rem; font-weight: bold;">0%</div>
                <div id="status-badge" class="status-badge">ê³„ì‚° ì¤‘...</div>
            </div>
        </div>
        <div class="main-grid">
            <div>
                <section>
                    <h2>1. ìˆ˜ì… ì„¤ì • (30ì¼ ê¸°ì¤€)</h2>
                    <table>
                        <thead><tr><th>ë“±ê¸‰</th><th>ì¸ì›</th><th>ìˆ˜ê°€</th><th>ì›” ìˆ˜ì…</th></tr></thead>
                        <tbody>
                            <tr><td>ì¼ë°˜ 1ë“±ê¸‰</td><td><input type="number" id="in-c1" value="5" oninput="calculate()"></td><td>93,070</td><td id="res-c1">0</td></tr>
                            <tr><td>ì¼ë°˜ 2ë“±ê¸‰</td><td><input type="number" id="in-c2" value="13" oninput="calculate()"></td><td>86,340</td><td id="res-c2">0</td></tr>
                            <tr><td>ì¼ë°˜ 3~5ë“±ê¸‰</td><td><input type="number" id="in-c3" value="34" oninput="calculate()"></td><td>81,540</td><td id="res-c3">0</td></tr>
                            <tr><td>ì¹˜ë§¤ì „ë‹´ 2ë“±ê¸‰</td><td><input type="number" id="in-cd2" value="0" oninput="calculate()"></td><td>96,950</td><td id="res-cd2">0</td></tr>
                            <tr><td>ì¹˜ë§¤ì „ë‹´ 3~5ë“±ê¸‰</td><td><input type="number" id="in-cd3" value="48" oninput="calculate()"></td><td>89,400</td><td id="res-cd3">0</td></tr>
                            <tr class="sub-total"><td>í•©ê³„</td><td id="total-cnt">0</td><td>-</td><td id="total-base-inc">0</td></tr>
                        </tbody>
                    </table>
                </section>
                <section style="margin-top:20px;">
                    <h2>2. ê°€ì‚° ìˆ˜ì… ìƒì„¸ (ì ìˆ˜ í¬í•¨)</h2>
                    <table style="background:#f1f9ff">
                        <tr><th>í•­ëª©</th><th>ì ìš© ì ìˆ˜</th><th>ê°€ì‚° ìˆ˜ì…ì•¡</th></tr>
                        <tr><th>ê°€ì‚° ê¸°ì¤€ì  (1ì ë‹¹)</th><td colspan="2" id="base-point-val" style="font-weight:bold; color:var(--accent); text-align:right; padding-right:15px;">0</td></tr>
                        <tr><td>ì•¼ê°„ ê°€ì‚° (ì¸ë‹¹ 0.9ì )</td><td id="score-night">0 ì </td><td id="res-night-inc">0</td></tr>
                        <tr><td>ì¸ë ¥ì¶”ê°€ ê°€ì‚° (í•œë„ ì ìš©) <small id="limit-info" style="color:#666;"></small></td><td id="score-staff">0 ì </td><td id="res-staff-inc">0</td></tr>
                        <tr><td>ì¹˜ë§¤ì „ë‹´ ìš”ì–‘ë³´í˜¸ì‚¬ ê°€ì‚° (ì¸ë‹¹ 1.3ì )</td><td id="score-dem-care">0 ì </td><td id="res-dem-care-inc">0</td></tr>
                        <tr><td>ê°„í˜¸ì‚¬ ê°€ì‚° (ì¸ë‹¹ 0.6ì  + ì‹œì„¤ 0.2ì )</td><td id="score-nurse">0 ì </td><td id="res-nurse-bonus-inc">0</td></tr>
                        <tr style="background:#fff"><td><b>ì¥ê¸°ê·¼ì† ì¥ë ¤ê¸ˆ ìˆ˜ì…</b></td><td>-</td><td><input type="number" id="long-term-val" value="0" oninput="calculate()"></td></tr>
                        <tr class="sub-total"><th>ì´ ì ìˆ˜ ë° ê°€ì‚° í•©ê³„</th><td id="score-total" style="color:#e67e22;">0 ì </td><td id="res-total-add-inc">0</td></tr>
                    </table>
                </section>
            </div>
            <div>
                <section>
                    <h2>3. ì¸ê±´ë¹„ ì„¤ì • (ì•¼ê°„ìˆ˜ë‹¹ í¬í•¨)</h2>
                    <table>
                        <thead>
                            <tr><th>ì§ì¢…</th><th>ë°°ì¹˜</th><th>ë²•ì •</th><th>ê¸°ë³¸ê¸‰</th><th>ê¸‰ì—¬ì†Œê³„</th><th>4ëŒ€ë³´í—˜</th><th>í‡´ì§</th><th>ì¸ê±´ë¹„ì´ê³„</th></tr>
                        </thead>
                        <tbody id="staff-table"></tbody>
                        <tfoot style="background:#fff9db">
                            <tr>
                                <td><b>ì•¼ê°„ì¸ë ¥</b></td>
                                <td><input type="number" id="night-cnt" value="1" oninput="calculate()"></td>
                                <td>-</td>
                                <td><input type="number" id="night-wage-info" value="1083600" readonly style="background:#eee"></td>
                                <td id="night-base-sum">0</td>
                                <td id="night-ins">0</td>
                                <td id="night-ret">0</td>
                                <td id="night-total" style="font-weight:bold; color:var(--danger)">0</td>
                            </tr>
                            <tr style="background:#e8f5e9">
                                <td><b>ì¥ê¸°ê·¼ì†ìˆ˜ë‹¹</b></td>
                                <td colspan="3"><small>4ëŒ€ë³´í—˜/í‡´ì§ê¸ˆ ì œì™¸</small></td>
                                <td id="long-term-base">0</td>
                                <td>-</td>
                                <td>-</td>
                                <td id="long-term-total" style="font-weight:bold;">0</td>
                            </tr>
                        </tfoot>
                    </table>
                </section>
                <section style="margin-top:20px;">
                    <h2>4. ì¸ê±´ë¹„ ì§€ì¶œ ë¹„ìœ¨ ë¶„ì„</h2>
                    <div class="analysis-box">
                        <p><b>ê¶Œì¥ ì¸ê±´ë¹„ ì´ì•¡ (62.6%):</b> <span id="target-labor-val" style="color:var(--success); font-weight:bold;">0</span> ì›</p>
                        <p><b>í˜„ì¬ 1ì¸ë‹¹ í‰ê·  ì¸ê±´ë¹„:</b> <span id="avg-labor-val" style="font-weight:bold;">0</span> ì›</p>
                        <hr>
                        <p id="analysis-text" style="margin:0; font-size:0.9rem;"></p>
                    </div>
                </section>
            </div>
        </div>
    </div>
    <div id="tab-night" class="tab-content"></div>
</div>

<script>
    function openTab(tabName) {
        document.querySelectorAll(".tab-content").forEach(tab => tab.classList.remove("active"));
        document.querySelectorAll(".tab-btn").forEach(btn => btn.classList.remove("active"));
        document.getElementById(tabName).classList.add("active");
        event.currentTarget.classList.add("active");
        if(tabName === 'tab-ratio') calculate(); else calcNight();
    }

    const staffMeta = {
        sw: { name: 'ì‚¬íšŒë³µì§€ì‚¬', pay: 2500000 },
        pt: { name: 'ë¬¼ë¦¬ì¹˜ë£Œì‚¬', pay: 2600000 },
        ot: { name: 'ì‘ì—…ì¹˜ë£Œì‚¬', pay: 2400000 },
        nurse: { name: 'ê°„í˜¸ì‚¬', pay: 2600000 },
        nurse_sub: { name: 'ê°„í˜¸ì¡°ë¬´ì‚¬', pay: 2300000 },
        care: { name: 'ìš”ì–‘ë³´í˜¸ì‚¬(ì¼ë°˜)', pay: 2156880 },
        care_dem: { name: 'ìš”ì–‘ë³´í˜¸ì‚¬(ì¹˜ë§¤)', pay: 2156880 }
    };

    function init() {
        const body = document.getElementById('staff-table');
        body.innerHTML = '';
        Object.entries(staffMeta).forEach(([key, info]) => {
            const tr = document.createElement('tr');
            tr.innerHTML = `<td align="left"><b>${info.name}</b></td><td><input type="number" id="cnt-${key}" value="${key==='care'?25:1}" oninput="calculate()"></td><td id="leg-${key}">0</td><td><input type="number" id="pay-${key}" value="${info.pay}" oninput="calculate()"></td><td id="base-sum-${key}">0</td><td id="ins-${key}">0</td><td id="ret-${key}">0</td><td id="total-${key}" style="font-weight:bold">0</td>`;
            body.appendChild(tr);
        });
        calculate();
    }

    function calculate() {
        const p_list = { c1:93070, c2:86340, c3:81540, cd2:96950, cd3:89400 };
        let inmates = 0, genInmates = 0, demInmates = 0, genInc = 0, baseInc = 0;

        ['c1', 'c2', 'c3', 'cd2', 'cd3'].forEach(k => {
            const cnt = Number(document.getElementById('in-'+k).value);
            const inc = cnt * p_list[k] * 30;
            document.getElementById('res-'+k).innerText = inc.toLocaleString();
            inmates += cnt;
            baseInc += inc;
            if(!k.startsWith('cd')) { genInmates += cnt; genInc += inc; }
            else { demInmates += cnt; }
        });

        document.getElementById('total-cnt').innerText = inmates + " ëª…";
        document.getElementById('top-inmates').innerText = inmates + " ëª…";
        document.getElementById('total-base-inc').innerText = baseInc.toLocaleString();

        let scoreLimit = 0;
        if (inmates < 10) scoreLimit = 1.4;
        else if (inmates < 30) scoreLimit = 2.6;
        else if (inmates < 50) scoreLimit = 4.0;
        else if (inmates < 70) scoreLimit = 5.2;
        else if (inmates < 90) scoreLimit = 6.6;
        else scoreLimit = 7.8;
        document.getElementById('limit-info').innerText = `(í•œë„: ${scoreLimit}ì )`;

        const legal = { 
            sw: inmates > 100 ? 2 : 1, 
            pt_ot: inmates >= 30 ? 1 : 0, 
            nurse_total: inmates <= 30 ? 1 : Math.ceil(inmates / 25), 
            care: Math.ceil(genInmates / 2.1),
            care_dem: Math.ceil(demInmates / 2.0)
        };

        let totalLabor = 0;
        let genAddScore = 0;
        let demCareAddScore = 0;
        let nurseAddScore = 0;
        let totalStaffCount = 0;

        const c_nurse = Number(document.getElementById('cnt-nurse').value);
        const c_nurse_sub = Number(document.getElementById('cnt-nurse_sub').value);
        const c_pt = Number(document.getElementById('cnt-pt').value);
        const c_ot = Number(document.getElementById('cnt-ot').value);
        const c_care_dem = Number(document.getElementById('cnt-care_dem').value);

        Object.entries(staffMeta).forEach(([key, info]) => {
            const cnt = Number(document.getElementById('cnt-'+key).value);
            const pay = Number(document.getElementById('pay-'+key).value);
            totalStaffCount += cnt;

            let legNum = (key === 'sw') ? legal.sw : (key === 'care') ? legal.care : (key === 'care_dem') ? legal.care_dem : 0;
            if(key === 'nurse' || key === 'nurse_sub') legNum = legal.nurse_total;
            if(key === 'pt' || key === 'ot') legNum = legal.pt_ot;
            document.getElementById('leg-'+key).innerText = legNum;

            const baseSum = pay * cnt;
            const ins = Math.floor(baseSum * 0.09);
            const ret = Math.floor(baseSum / 12);
            document.getElementById(`base-sum-${key}`).innerText = baseSum.toLocaleString();
            document.getElementById(`ins-${key}`).innerText = ins.toLocaleString();
            document.getElementById(`ret-${key}`).innerText = ret.toLocaleString();
            document.getElementById(`total-${key}`).innerText = (baseSum + ins + ret).toLocaleString();
            totalLabor += (baseSum + ins + ret);

            // ê°€ì‚°ì  ë¡œì§ ìˆ˜ì •
            if(key === 'sw' && cnt > legal.sw) genAddScore += (cnt - legal.sw) * 1.4;
            if(key === 'care_dem' && cnt > legal.care_dem) demCareAddScore += (cnt - legal.care_dem) * 1.3;
        });

        if((c_nurse + c_nurse_sub) > legal.nurse_total) genAddScore += (c_nurse + c_nurse_sub - legal.nurse_total) * 1.2;
        if((c_pt + c_ot) > legal.pt_ot) genAddScore += (c_pt + c_ot - legal.pt_ot) * 1.4;

        // ê°„í˜¸ì‚¬ ê°€ì‚° (ì¸ë‹¹ 0.6 + ì‹œì„¤ 0.2)
        if(c_nurse > 0) nurseAddScore = (c_nurse * 0.6) + 0.2;

        const nCnt = Number(document.getElementById('night-cnt').value);
        const nTotal = Math.floor(1083600 * nCnt * (1 + 0.09 + 1/12));
        totalLabor += nTotal;
        totalStaffCount += nCnt;

        const longTermValue = Number(document.getElementById('long-term-val').value);
        document.getElementById('long-term-base').innerText = longTermValue.toLocaleString();
        document.getElementById('long-term-total').innerText = longTermValue.toLocaleString();
        totalLabor += longTermValue;

        const basePoint = genInmates > 0 ? Math.floor((genInc / genInmates) * 0.8) : 0;
        document.getElementById('base-point-val').innerText = basePoint.toLocaleString();

        const finalNightScore = nCnt * 0.9;
        const finalGenScore = Math.min(genAddScore, scoreLimit);
        
        // ìµœì¢… ì ìˆ˜ ë° ìˆ˜ì… ê³„ì‚°
        const totalScore = finalNightScore + finalGenScore + demCareAddScore + nurseAddScore;

        const resNightInc = Math.floor(basePoint * finalNightScore);
        const resStaffInc = Math.floor(basePoint * finalGenScore);
        const resDemCareInc = Math.floor(basePoint * demCareAddScore);
        const resNurseInc = Math.floor(basePoint * nurseAddScore);
        
        document.getElementById('score-night').innerText = finalNightScore.toFixed(1) + " ì ";
        document.getElementById('score-staff').innerText = finalGenScore.toFixed(1) + " ì ";
        document.getElementById('score-dem-care').innerText = demCareAddScore.toFixed(1) + " ì ";
        document.getElementById('score-nurse').innerText = nurseAddScore.toFixed(1) + " ì ";
        document.getElementById('score-total').innerText = totalScore.toFixed(1) + " ì ";

        document.getElementById('res-night-inc').innerText = resNightInc.toLocaleString();
        document.getElementById('res-staff-inc').innerText = resStaffInc.toLocaleString();
        document.getElementById('res-dem-care-inc').innerText = resDemCareInc.toLocaleString();
        document.getElementById('res-nurse-bonus-inc').innerText = resNurseInc.toLocaleString();

        const totalAddInc = resNightInc + resStaffInc + resDemCareInc + resNurseInc + longTermValue;
        document.getElementById('res-total-add-inc').innerText = totalAddInc.toLocaleString();
        
        const totalFinalInc = baseInc + totalAddInc;
        document.getElementById('top-total-income').innerText = totalFinalInc.toLocaleString();
        document.getElementById('top-total-labor').innerText = totalLabor.toLocaleString();
        
        const ratio = totalFinalInc > 0 ? (totalLabor / totalFinalInc * 100).toFixed(1) : 0;
        document.getElementById('top-ratio').innerText = ratio + "%";

        const targetLabor = Math.floor(totalFinalInc * 0.626);
        document.getElementById('target-labor-val').innerText = targetLabor.toLocaleString();
        document.getElementById('avg-labor-val').innerText = totalStaffCount > 0 ? Math.floor(totalLabor / totalStaffCount).toLocaleString() : 0;

        const badge = document.getElementById('status-badge');
        const card = document.getElementById('ratio-card');
        const analysis = document.getElementById('analysis-text');

        if(ratio >= 62.6) {
            badge.innerText = "ì¤€ìˆ˜ (PASS)"; badge.className = "status-badge pass";
            card.style.background = "var(--success)";
            analysis.innerHTML = `ì¸ê±´ë¹„ ì§€ì¶œ ë¹„ìœ¨ ê¸°ì¤€ì„ ì¶©ì¡±í•©ë‹ˆë‹¤. <br>ê¶Œì¥ ì§€ì¶œì•¡ ëŒ€ë¹„ <b>${(totalLabor - targetLabor).toLocaleString()}ì›</b> ì¶”ê°€ ì§€ì¶œ ì¤‘ì…ë‹ˆë‹¤.`;
        } else {
            badge.innerText = "ë¯¸ë‹¬ (FAIL)"; badge.className = "status-badge fail";
            card.style.background = "var(--danger)";
            analysis.innerHTML = `ì¸ê±´ë¹„ ì§€ì¶œ ë¹„ìœ¨ì´ ë‚®ìŠµë‹ˆë‹¤. <br>ê¶Œì¥ ê¸°ì¤€ ë‹¬ì„±ì„ ìœ„í•´ <b>${(targetLabor - totalLabor).toLocaleString()}ì›</b> ì´ìƒì˜ ì¶”ê°€ ì§€ì¶œì´ í•„ìš”í•©ë‹ˆë‹¤.`;
        }
    }
    window.onload = init;
</script>
</body>
</html>