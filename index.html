<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>요양원 인건비 지출 비율 시뮬레이터 v4.2</title>
    <style>
        :root {
            --primary: #2c3e50; --accent: #3498db; --success: #27ae60; --danger: #e74c3c; --bg: #f1f4f9;
        }
        body { font-family: 'Pretendard', sans-serif; background: var(--bg); margin: 0; padding: 20px; color: #333; }
        .container { max-width: 98%; margin: 0 auto; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        
        .dashboard { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 25px; }
        .card { background: var(--primary); color: white; padding: 15px; border-radius: 12px; text-align: center; }
        .card h3 { margin: 0; font-size: 0.9rem; opacity: 0.8; }
        .card .value { font-size: 1.5rem; font-weight: bold; margin: 5px 0; color: #fff; }

        .main-grid { display: grid; grid-template-columns: 1fr 1.6fr; gap: 25px; }
        section { background: #fff; border: 1px solid #e0e6ed; padding: 20px; border-radius: 12px; }
        h2 { font-size: 1.2rem; color: var(--primary); border-left: 5px solid var(--accent); padding-left: 10px; margin-bottom: 15px; }

        table { width: 100%; border-collapse: collapse; margin-bottom: 15px; }
        th, td { border: 1px solid #eee; padding: 8px 4px; text-align: center; font-size: 0.85rem; }
        th { background: #f8f9fa; color: #666; }
        input { width: 90%; padding: 6px; border: 1px solid #ccc; border-radius: 4px; text-align: right; font-weight: bold; font-family: inherit; }
        
        .sub-total { background: #f8f9fa; font-weight: bold; }
        .status-badge { display: inline-block; padding: 5px 15px; border-radius: 20px; font-weight: bold; margin-top: 5px; }
        .pass { background: #2ecc71; color: white; }
        .fail { background: #e74c3c; color: white; }
        .analysis-box { background: #f9f9f9; padding: 15px; border-radius: 8px; border: 1px dashed #ccc; }
        input.error { border: 2px solid var(--danger); background: #fff5f5; }
        
        /* 점수 표시용 스타일 */
        .score-tag { color: #e67e22; font-weight: bold; font-size: 0.8rem; margin-left: 5px; }
    </style>
</head>
<body>

<div class="container">
    <h1 style="text-align:center; color:var(--primary); margin-top:0;">요양원 인건비 지출 비율 시뮬레이터</h1>

    <div class="dashboard">
        <div class="card"><h3>총 입소 인원</h3><div id="top-inmates" class="value">0 명</div></div>
        <div class="card"><h3>총 급여 수입 (A)</h3><div id="top-total-income" class="value">0</div></div>
        <div class="card"><h3>총 인건비 지출 (B)</h3><div id="top-total-labor" class="value">0</div></div>
        <div id="ratio-card" class="card">
            <h3>인건비 지출 비율 (B/A)</h3>
            <div id="top-ratio" style="font-size: 1.8rem; font-weight: bold;">0%</div>
            <div id="status-badge" class="status-badge">계산 중...</div>
        </div>
    </div>

    <div class="main-grid">
        <div>
            <section>
                <h2>1. 수입 설정 (30일 기준)</h2>
                <table>
                    <thead><tr><th>등급</th><th>인원</th><th>수가</th><th>월 수입</th></tr></thead>
                    <tbody>
                        <tr><td>일반 1등급</td><td><input type="number" id="in-c1" value="5" oninput="calculate()"></td><td>93,070</td><td id="res-c1">0</td></tr>
                        <tr><td>일반 2등급</td><td><input type="number" id="in-c2" value="13" oninput="calculate()"></td><td>86,340</td><td id="res-c2">0</td></tr>
                        <tr><td>일반 3~5등급</td><td><input type="number" id="in-c3" value="34" oninput="calculate()"></td><td>81,540</td><td id="res-c3">0</td></tr>
                        <tr><td>치매전담 2등급</td><td><input type="number" id="in-cd2" value="0" oninput="calculate()"></td><td>96,950</td><td id="res-cd2">0</td></tr>
                        <tr><td>치매전담 3~5등급</td><td><input type="number" id="in-cd3" value="48" oninput="calculate()"></td><td>89,400</td><td id="res-cd3">0</td></tr>
                        <tr class="sub-total"><td>합계</td><td id="total-cnt">0</td><td>-</td><td id="total-base-inc">0</td></tr>
                    </tbody>
                </table>
            </section>

            <section style="margin-top:20px;">
                <h2>2. 가산 수입 상세 (점수 포함)</h2>
                <table style="background:#f1f9ff">
                    <tr><th>항목</th><th>적용 점수</th><th>가산 수입액</th></tr>
                    <tr><th>가산 기준점 (1점당)</th><td colspan="2" id="base-point-val" style="font-weight:bold; color:var(--accent); text-align:right; padding-right:15px;">0</td></tr>
                    <tr><td>야간 가산 (인당 0.9점)</td><td id="score-night">0 점</td><td id="res-night-inc">0</td></tr>
                    <tr><td>인력추가 가산 (일반실 한도내)</td><td id="score-staff">0 점</td><td id="res-staff-inc">0</td></tr>
                    <tr><td>치매전담 요양보호사 가산</td><td id="score-dem-care">0 점</td><td id="res-dem-care-inc">0</td></tr>
                    <tr><td>간호사 가산 (인당0.6+시설0.2)</td><td id="score-nurse">0 점</td><td id="res-nurse-bonus-inc">0</td></tr>
                    <tr class="sub-total"><th>총 점수 및 가산 합계</th><td id="score-total" style="color:#e67e22;">0 점</td><td id="res-total-add-inc">0</td></tr>
                </table>
            </section>
        </div>

        <div>
            <section>
                <h2>3. 인건비 설정 (야간수당 포함)</h2>
                <table>
                    <thead>
                        <tr><th>직종</th><th>배치</th><th>법정</th><th>기본급</th><th>급여소계</th><th>4대보험(9%)</th><th>퇴직(1/12)</th><th>인건비총계</th></tr>
                    </thead>
                    <tbody id="staff-table"></tbody>
                    <tfoot style="background:#fff9db">
                        <tr>
                            <td><b>야간인력</b></td>
                            <td><input type="number" id="night-cnt" value="1" oninput="calculate()"></td>
                            <td>-</td>
                            <td><input type="number" id="night-wage-info" value="1083600" readonly style="background:#eee"></td>
                            <td id="night-base-sum">0</td>
                            <td id="night-ins">0</td>
                            <td id="night-ret">0</td>
                            <td id="night-total" style="font-weight:bold; color:var(--danger)">0</td>
                        </tr>
                    </tfoot>
                </table>
            </section>

            <section style="margin-top:20px;">
                <h2>4. 인건비 지출 비율 분석</h2>
                <div class="analysis-box">
                    <p><b>권장 인건비 총액 (62.6%):</b> <span id="target-labor-val" style="color:var(--success); font-weight:bold;">0</span> 원</p>
                    <p><b>현재 1인당 평균 인건비:</b> <span id="avg-labor-val" style="font-weight:bold;">0</span> 원</p>
                    <hr>
                    <p id="analysis-text" style="margin:0; font-size:0.9rem;"></p>
                </div>
            </section>
        </div>
    </div>
</div>

<script>
    const staffMeta = {
        sw: { name: '사회복지사', pay: 2500000 },
        pt: { name: '물리치료사', pay: 2600000 },
        ot: { name: '작업치료사', pay: 2400000 },
        nurse: { name: '간호사', pay: 2600000 },
        nurse_sub: { name: '간호조무사', pay: 2300000 },
        care: { name: '요양보호사(일반)', pay: 2156880 },
        care_dem: { name: '요양보호사(치매)', pay: 2250000 }
    };

    function init() {
        const body = document.getElementById('staff-table');
        Object.entries(staffMeta).forEach(([key, info]) => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td align="left"><b>${info.name}</b></td>
                <td><input type="number" id="cnt-${key}" value="${key==='care'?25:1}" oninput="calculate()"></td>
                <td id="leg-${key}">0</td>
                <td><input type="number" id="pay-${key}" value="${info.pay}" oninput="calculate()"></td>
                <td id="base-sum-${key}">0</td>
                <td id="ins-${key}">0</td>
                <td id="ret-${key}">0</td>
                <td id="total-${key}" style="font-weight:bold">0</td>
            `;
            body.appendChild(tr);
        });
        calculate();
    }

    function calculate() {
        const p_list = { c1:93070, c2:86340, c3:81540, cd2:96950, cd3:89400 };
        let inmates = 0, genInmates = 0, demInmates = 0, genInc = 0, baseInc = 0;

        ['c1', 'c2', 'c3', 'cd2', 'cd3'].forEach(k => {
            const cnt = Number(document.getElementById('in-'+k).value);
            const inc = cnt * p_list[k] * 30;
            document.getElementById('res-'+k).innerText = inc.toLocaleString();
            inmates += cnt;
            baseInc += inc;
            if(!k.startsWith('cd')) { genInmates += cnt; genInc += inc; }
            else { demInmates += cnt; }
        });

        document.getElementById('total-cnt').innerText = inmates + " 명";
        document.getElementById('top-inmates').innerText = inmates + " 명";
        document.getElementById('total-base-inc').innerText = baseInc.toLocaleString();

        // 정원별 가산 한도
        let scoreLimit = inmates < 30 ? 2.6 : inmates < 50 ? 4.0 : inmates < 90 ? 6.6 : 7.8;
        const legal = {
            sw: inmates > 100 ? 2 : 1,
            pt_ot: inmates >= 30 ? 1 : 0,
            nurse_total: inmates <= 30 ? 1 : Math.ceil(inmates / 25),
            care: Math.ceil(genInmates / 2.1),
            care_dem: Math.ceil(demInmates / 2.0)
        };

        let totalLabor = 0;
        let genAddScore = 0;
        let demCareAddScore = 0;
        let totalStaffCount = 0;

        const c_nurse = Number(document.getElementById('cnt-nurse').value);
        const c_nurse_sub = Number(document.getElementById('cnt-nurse_sub').value);
        const c_pt = Number(document.getElementById('cnt-pt').value);
        const c_ot = Number(document.getElementById('cnt-ot').value);

        Object.entries(staffMeta).forEach(([key, info]) => {
            const cnt = Number(document.getElementById('cnt-'+key).value);
            const pay = Number(document.getElementById('pay-'+key).value);
            const input = document.getElementById('cnt-'+key);
            totalStaffCount += cnt;

            let legNum = (key === 'sw') ? legal.sw : (key === 'care') ? legal.care : (key === 'care_dem') ? legal.care_dem : 0;
            if(key === 'nurse' || key === 'nurse_sub') legNum = legal.nurse_total;
            if(key === 'pt' || key === 'ot') legNum = legal.pt_ot;
            
            document.getElementById('leg-'+key).innerText = legNum;
            if((key === 'nurse' || key === 'nurse_sub' ? c_nurse+c_nurse_sub : key === 'pt' || key === 'ot' ? c_pt+c_ot : cnt) < legNum) input.classList.add('error'); else input.classList.remove('error');

            const baseSum = pay * cnt;
            const ins = Math.floor(baseSum * 0.09);
            const ret = Math.floor(baseSum / 12);
            document.getElementById(`base-sum-${key}`).innerText = baseSum.toLocaleString();
            document.getElementById(`ins-${key}`).innerText = ins.toLocaleString();
            document.getElementById(`ret-${key}`).innerText = ret.toLocaleString();
            document.getElementById(`total-${key}`).innerText = (baseSum + ins + ret).toLocaleString();
            totalLabor += (baseSum + ins + ret);

            // 가산점 계산 (사회복지사 1.4)
            if(key === 'sw' && cnt > legal.sw) genAddScore += (cnt - legal.sw) * 1.4;
            // 가산점 계산 (치매 요양 1.3)
            if(key === 'care_dem' && cnt > legal.care_dem) demCareAddScore += (cnt - legal.care_dem) * 1.3;
        });

        // 통합 직종 가산 (간호 1.2, 물치/작치 1.4)
        if((c_nurse + c_nurse_sub) > legal.nurse_total) genAddScore += (c_nurse + c_nurse_sub - legal.nurse_total) * 1.2;
        if((c_pt + c_ot) > legal.pt_ot) genAddScore += (c_pt + c_ot - legal.pt_ot) * 1.4;

        // 야간수당 인건비
        const nCnt = Number(document.getElementById('night-cnt').value);
        const nBaseSum = 1083600 * nCnt;
        const nIns = Math.floor(nBaseSum * 0.09);
        const nRet = Math.floor(nBaseSum / 12);
        const nTotal = nBaseSum + nIns + nRet;
        document.getElementById('night-base-sum').innerText = nBaseSum.toLocaleString();
        document.getElementById('night-ins').innerText = nIns.toLocaleString();
        document.getElementById('night-ret').innerText = nRet.toLocaleString();
        document.getElementById('night-total').innerText = nTotal.toLocaleString();
        totalLabor += nTotal;
        totalStaffCount += nCnt;

        // 수입 계산용 기준점
        const basePoint = genInmates > 0 ? Math.floor((genInc / genInmates) * 0.8) : 0;
        document.getElementById('base-point-val').innerText = basePoint.toLocaleString();

        // --- 점수 표시 로직 ---
        const finalNightScore = nCnt * 0.9;
        const finalGenScore = Math.min(genAddScore, scoreLimit);
        const finalDemScore = demCareAddScore;
        const finalNurseScore = c_nurse > 0 ? (c_nurse * 0.6) + 0.2 : 0;
        const totalScore = finalNightScore + finalGenScore + finalDemScore + finalNurseScore;

        document.getElementById('score-night').innerText = finalNightScore.toFixed(1) + " 점";
        document.getElementById('score-staff').innerText = finalGenScore.toFixed(1) + " 점";
        document.getElementById('score-dem-care').innerText = finalDemScore.toFixed(1) + " 점";
        document.getElementById('score-nurse').innerText = finalNurseScore.toFixed(1) + " 점";
        document.getElementById('score-total').innerText = totalScore.toFixed(1) + " 점";

        // 수입 합계
        const resNightInc = Math.floor(basePoint * finalNightScore);
        const resStaffInc = Math.floor(basePoint * finalGenScore);
        const resDemCareInc = Math.floor(basePoint * finalDemScore);
        const resNurseBonusInc = Math.floor(basePoint * finalNurseScore);

        document.getElementById('res-night-inc').innerText = resNightInc.toLocaleString();
        document.getElementById('res-staff-inc').innerText = resStaffInc.toLocaleString();
        document.getElementById('res-dem-care-inc').innerText = resDemCareInc.toLocaleString();
        document.getElementById('res-nurse-bonus-inc').innerText = resNurseBonusInc.toLocaleString();

        const totalAddInc = resNightInc + resStaffInc + resDemCareInc + resNurseBonusInc;
        document.getElementById('res-total-add-inc').innerText = totalAddInc.toLocaleString();
        
        const totalFinalInc = baseInc + totalAddInc;

        // 결과 업데이트
        document.getElementById('top-total-income').innerText = totalFinalInc.toLocaleString();
        document.getElementById('top-total-labor').innerText = totalLabor.toLocaleString();
        const ratio = totalFinalInc > 0 ? (totalLabor / totalFinalInc * 100).toFixed(1) : 0;
        document.getElementById('top-ratio').innerText = ratio + "%";

        const targetLabor = Math.floor(totalFinalInc * 0.626);
        document.getElementById('target-labor-val').innerText = targetLabor.toLocaleString();
        document.getElementById('avg-labor-val').innerText = totalStaffCount > 0 ? Math.floor(totalLabor / totalStaffCount).toLocaleString() : 0;

        const badge = document.getElementById('status-badge');
        const card = document.getElementById('ratio-card');
        const analysis = document.getElementById('analysis-text');

        if(ratio >= 62.6) {
            badge.innerText = "준수 (PASS)"; badge.className = "status-badge pass";
            card.style.background = "var(--success)";
            analysis.innerHTML = `인건비 지출 비율 기준을 충족합니다. <br>권장 지출액 대비 <b>${(totalLabor - targetLabor).toLocaleString()}원</b> 추가 지출 중입니다.`;
        } else {
            badge.innerText = "미달 (FAIL)"; badge.className = "status-badge fail";
            card.style.background = "var(--danger)";
            analysis.innerHTML = `인건비 지출 비율이 낮습니다. <br>권장 기준 달성을 위해 <b>${(targetLabor - totalLabor).toLocaleString()}원</b> 이상의 추가 지출이 필요합니다.`;
        }
    }
    window.onload = init;
</script>
</body>
</html>